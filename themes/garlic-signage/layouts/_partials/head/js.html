{{- $opts := dict "minify" true -}}

{{- with resources.Get "js/main.js" }}
	{{- $opts := dict
		"minify" (not hugo.IsDevelopment)
		"sourceMap" (cond hugo.IsDevelopment "external" "")
		"targetPath" "js/main.js"
	}}
	{{- with . | js.Build $opts }}
	{{- if hugo.IsDevelopment }}
		  <script src="{{ .RelPermalink }}"></script>
	{{- else }}
	{{- with . | fingerprint }}
			<script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous"></script>
	{{- end }}
	{{- end }}
	{{- end }}
{{- end }}

{{- range .Params.customJS }}
{{- with (resources.Get (printf "js/%s.js" .) | js.Build $opts | fingerprint "sha384") }}
    <script src="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" defer></script>
{{- end }}
{{- end }}
